extends "res://addons/retro_console_emulator/tests/base_test.gd"


func test():
	test_0x4c_jmp_absolute_jump()
	test_0x6c_jmp_indirect_jump()


func test_0x4c_jmp_absolute_jump():
	var cpu = NesCPU.new()
	cpu.load_and_run([
		0x4c, 0x0a, 0x80, # JMP #$0x800A
		0xa9, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xa9, 0x05,
		0x00
	])
	assert(cpu.register_a.value == 0x05)
	print("test_0x4c_jmp_absolute_jump passed!")

func test_0x6c_jmp_indirect_jump():
	var cpu = NesCPU.new()
	cpu.memory.mem_write_16(0x4003, 0x800A)
	cpu.load_and_run([
		0x6c, 0x03, 0x40, # JMP $0x4003
		0xa9, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xa9, 0x05,
		0x00
	])
	# IMPORTANT: Testing 6502 bug scenario
	assert(cpu.register_a.value == 0x05)
	cpu.memory.mem_write(0x30FF, 0x0A)
	cpu.memory.mem_write(0x3000, 0x80)
	cpu.load_and_run([
		0x6c, 0xFF, 0x30, # JMP $0x30FF
		0xa9, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
		0xa9, 0x05,
		0x00
	])
	assert(cpu.register_a.value == 0x05)
	print("test_0x6c_jmp_indirect_jump passed!")
